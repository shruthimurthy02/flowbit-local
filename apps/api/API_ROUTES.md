# API Routes Documentation

## Base URL
`http://localhost:3001`

## Routes

### GET /stats
Returns dashboard statistics.

**Response:**
```json
{
  "totalSpend": 21670.00,
  "totalInvoicesProcessed": 5,
  "documentsUploaded": 5,
  "averageInvoiceValue": 4334.00,
  "pendingInvoices": 1,
  "paidInvoices": 3,
  "overdueInvoices": 1
}
```

### GET /invoice-trends
Returns monthly invoice trends grouped by month.

**Response:**
```json
[
  {
    "month": "2024-01",
    "invoiceCount": 2,
    "totalSpend": 6820.00
  },
  {
    "month": "2024-02",
    "invoiceCount": 3,
    "totalSpend": 14850.00
  }
]
```

### GET /vendors/top10
Returns top 10 vendors by total spend.

**Response:**
```json
[
  {
    "vendor": "Tech Solutions Inc",
    "totalSpend": 8800.00,
    "invoiceCount": 2
  },
  {
    "vendor": "Marketing Pro",
    "totalSpend": 8800.00,
    "invoiceCount": 1
  }
]
```

### GET /category-spend
Returns spending grouped by category (using invoice status as category proxy).

**Response:**
```json
[
  {
    "category": "paid",
    "totalSpend": 10120.00,
    "invoiceCount": 3
  },
  {
    "category": "pending",
    "totalSpend": 8800.00,
    "invoiceCount": 1
  },
  {
    "category": "overdue",
    "totalSpend": 2750.00,
    "invoiceCount": 1
  }
]
```

### GET /cash-outflow
Returns cash outflow grouped by due date ranges.

**Query Parameters:** None

**Response:**
```json
[
  {
    "dueDateRange": "Overdue",
    "totalAmount": 2750.00,
    "invoiceCount": 1
  },
  {
    "dueDateRange": "This Month",
    "totalAmount": 8800.00,
    "invoiceCount": 1
  }
]
```

### GET /invoices
Returns paginated, searchable invoice list.

**Query Parameters:**
- `q` (optional): Search query (searches invoice ID, status, vendor name, customer name)
- `page` (optional): Page number (default: 1)
- `per_page` (optional): Items per page (default: 20, max: 100)
- `sort` (optional): Sort field - `date`, `amount`, `status`, `vendor`, `customer` (default: `date`)
- `order` (optional): Sort order - `asc` or `desc` (default: `desc`)
- `status` (optional): Filter by status

**Response:**
```json
{
  "page": 1,
  "per_page": 20,
  "total": 5,
  "totalPages": 1,
  "data": [
    {
      "id": "inv-001",
      "vendor": {
        "id": "vendor-1",
        "name": "Tech Solutions Inc",
        "email": "contact@techsolutions.com"
      },
      "customer": {
        "id": "customer-1",
        "name": "Acme Corporation",
        "email": "billing@acme.com"
      },
      "date": "2024-01-15T00:00:00.000Z",
      "dueDate": "2024-02-15T00:00:00.000Z",
      "amount": 5500.00,
      "status": "paid"
    }
  ]
}
```

### POST /chat-with-data
Forwards question to Vanna service and returns SQL and results.

**Request Body:**
```json
{
  "question": "What are the top 5 vendors by total spend?"
}
```

**Response:**
```json
{
  "sql": "SELECT v.name as vendor, SUM(i.amount) as total_spend FROM \"Invoice\" i JOIN \"Vendor\" v ON i.\"vendorId\" = v.id GROUP BY v.name ORDER BY total_spend DESC LIMIT 5;",
  "notes": "Generated by Vanna (heuristic fallback)",
  "results": [
    {
      "vendor": "Tech Solutions Inc",
      "total_spend": 8800.00
    }
  ]
}
```

**Environment Variables:**
- `VANNA_API_BASE_URL`: Vanna service URL (default: `http://localhost:8000`)
- `VANNA_API_KEY`: Optional API key for Vanna service

## Error Responses

All routes return error responses in the following format:

```json
{
  "error": "Error message",
  "message": "Detailed error message"
}
```

Status codes:
- `400`: Bad Request (missing or invalid parameters)
- `500`: Internal Server Error
- `502`: Bad Gateway (Vanna service error)
- `503`: Service Unavailable (Vanna service not reachable)

