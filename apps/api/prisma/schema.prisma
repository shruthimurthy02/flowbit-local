generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// High-level category for grouping invoices (e.g. Software, Utilities)
model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  invoices Invoice[]
}

/// Entity you pay money to (vendor/supplier)
model Vendor {
  id       String    @id @default(uuid())
  name     String
  email    String?
  phone    String?
  address  String?
  invoices Invoice[]
}

/// Entity that receives invoices (customer)
model Customer {
  id       String    @id @default(uuid())
  name     String
  email    String?
  phone    String?
  address  String?
  invoices Invoice[]
}

/// Top-level invoice record
model Invoice {
  id            String         @id @default(uuid())
  invoiceNumber String         @unique

  vendorId   String
  customerId String?
  categoryId String?

  issueDate DateTime           @default(now())
  dueDate   DateTime?

  status       InvoiceStatus   @default(PENDING)
  subtotal     Decimal         @default(0)
  tax          Decimal         @default(0)
  totalAmount  Decimal         @default(0)
  notes        String?

  vendor   Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  customer Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
  category Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  lineItems LineItem[]
  payments  Payment[]

  @@index([vendorId])
  @@index([customerId])
  @@index([categoryId])
  @@index([issueDate])
  @@index([dueDate])
  @@index([status])
}

/// Individual line items within an invoice
model LineItem {
  id          String   @id @default(uuid())
  invoiceId   String

  description String?
  category    String?
  quantity    Decimal  @default(1)
  unitPrice   Decimal  @default(0)
  amount      Decimal  @default(0)
  tax         Decimal  @default(0)

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
}

/// Payments applied to an invoice
model Payment {
  id         String   @id @default(uuid())
  invoiceId  String

  amount     Decimal
  paymentDate DateTime  @default(now())
  method     String?
  reference  String?

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([paymentDate])
}

/// Enum for invoice lifecycle status
enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}
